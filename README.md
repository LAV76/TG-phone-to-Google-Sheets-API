# Telegram-бот для сохранения телефонных номеров в Google Sheets
Этот Telegram-бот позволяет пользователям отправлять свои телефонные номера, которые затем сохраняются в документе Google Sheets. Бот поддерживает различные форматы телефонных номеров, включая международные коды, и гарантирует, что только уникальные номера добавляются в таблицу.
## Содержание
1. [Особенности](#особенности)
2. [Предварительные требования](#предварительные-требования)
3. [Установка](#установка)
4. [Настройка](#настройка)
5. [Запуск бота](#запуск-бота)
6. [Поддержка Docker](#поддержка-docker)
7. [Как это работает](#как-это-работает)
8. [Контакты](#контакты)

---
## Особенности
- Принимает телефонные номера в различных форматах (например, `+79265958382`, `89265958382`, `(926) 595-83-82`, `0012345678900`).
- Преобразует все номера в стандартный международный формат (например, `+7XXXXXXXXXX`).
- Проверяет дубликаты в Google Sheets перед сохранением.
- Логирует ошибки для отладки.
- Поддерживает Docker для удобного развертывания.
---
## Предварительные требования
Перед запуском бота убедитесь, что у вас есть следующее:
1. Установленный **Python 3.8+** на вашей системе.
2. Проект в **Google Cloud** с включенным API Google Sheets.
3. **JSON-ключ сервисного аккаунта** для доступа к Google Sheets.
4. **Токен Telegram-бота** от [@BotFather](https://t.me/BotFather).
5. **Docker** (опционально, для запуска в контейнере).
---
## Установка
### Шаг 1: Клонирование репозитория
Склонируйте этот репозиторий на ваш локальный компьютер:
```bash
git clone https://github.com/LAV76/TG-phone-to-Google-Sheets-API.git
cd TG-phone-to-Google-Sheets-API
```
### Шаг 2: Установка зависимостей
Установите необходимые Python-пакеты с помощью pip:
```bash
pip install -r requirements.txt
```
Если вы используете Docker, пропустите этот шаг и перейдите к разделу [Поддержка Docker](#поддержка-docker).

---

## Настройка
### Шаг 1: Создание файла .env
Создайте файл .env в корневой директории проекта и добавьте следующие переменные:
```bash
BOT_TOKEN="your_bot_token"
GOOGLE_SPREADSHEET_ID='your_spreadsheet_id'
```
**Как получить эти значения:**
- **BOT_TOKEN**: Создайте бота через [**@BotFather**](https://t.me/BotFather?spm=5aebb161.9aec867.0.0.7089c9212uY4m1) и скопируйте токен.
- **GOOGLE_SPREADSHEET_ID:** Извлеките ID из URL вашей Google таблицы (см. инструкцию ниже).
### Шаг 2: Настройка Google Sheets API
1. Перейдите в [**Google Cloud Console**](https://console.cloud.google.com/?spm=5aebb161.9aec867.0.0.7089c9212uY4m1) .
2. Создайте новый проект или выберите существующий.
3. Включите API Google Sheets:
    - Перейдите в раздел "APIs & Services" → "Library".
    - Найдите "Google Sheets API" и включите его.
4. Создайте учетные данные (Credentials):
    - Перейдите в раздел "APIs & Services" → "Credentials".
    - Нажмите "Create Credentials" → "Service account".
    - Заполните необходимые поля и создайте сервисный аккаунт.
    - Скачайте JSON-файл с ключами.
5. Поделитесь своей Google таблицей с email сервисного аккаунта (он указан в JSON-файле).
### Шаг 3: Получение ID Google таблицы
ID вашей Google таблицы можно найти в URL-адресе самой таблицы. Вот пошаговая инструкция:
1. Откройте вашу Google таблицу в браузере.
2. Посмотрите на URL-адрес. Он будет выглядеть примерно так:
    ```bash
    https://docs.google.com/spreadsheets/d/1aBcDeFgHiJkLmNoPqRsTuVwXyZ1234567890/edit#gid=0
    ```
3. Найдите ID таблицы — это длинная строка символов между /d/ и /edit. В данном примере:
    ```bash
    1aBcDeFgHiJkLmNoPqRsTuVwXyZ1234567890
    ```
4. Замените SPREADSHEET_ID в файле .env на найденный ID:
    ```bash
    GOOGLE_SPREADSHEET_ID='1aBcDeFgHiJkLmNoPqRsTuVwXyZ1234567890'
    ```
    
---
## Запуск бота
### Вариант 1: Запуск локально
Запустите бота, выполнив следующую команду:
```bash
python bot.py
```
Бот начнет получать обновления и отвечать на сообщения пользователей.
### Вариант 2: Запуск через Docker
Если вы предпочитаете запускать бота в Docker-контейнере, выполните следующие шаги:
1. Соберите Docker-образ:
     ```bash
    docker build -t tg-bot .
    ```
2. Запустите Docker-контейнер:
    ```bash
    docker run --name tg-bot-container tg-bot
    ```
3. (Опционально) Используйте тома для монтирования файла .env и ключей:
    ```bash
    docker run --name tg-bot-container -v $(pwd):/app tg-bot
    ```
    
---

## Поддержка Docker
Проект включает Dockerfile для запуска в контейнере. Это обеспечивает согласованность среды и упрощает развертывание.
**Обзор Dockerfile**
- Базовый образ: python:3.10-slim.
- Устанавливает зависимости из requirements.txt.
- Копирует файлы проекта в контейнер.
- Запускает бота с помощью команды CMD ["python", "bot.py"].
    
---

## Как это работает
### 1. Взаимодействие с пользователем
- Пользователи запускают бота, отправив команду /start.
- Бот просит пользователя ввести свой телефонный номер.
- Бот обрабатывает ввод, проверяет его корректность и ищет дубликаты в Google таблице.
### 2. Форматирование телефонного номера
- Удаляет все нецифровые символы (например, +, -, (, )).
- Заменяет 00 на + для международных кодов.
- Преобразует российские номера, начинающиеся с 8, в +7.
- Гарантирует, что итоговый формат будет +<код_страны><номер>.
### 3. Интеграция с Google Sheets
- Использует библиотеку gspread для взаимодействия с Google Sheets.
- Добавляет новые номера в первый столбец таблицы.
- Проверяет наличие дубликатов перед добавлением.
    
---
## Контакты
Если у вас есть вопросы или нужна помощь, свяжитесь со мной:
Telegram: [@lekoncev](https://t.me/lekoncev)
вот текст размеченный в md надо сделать копию его на английском
